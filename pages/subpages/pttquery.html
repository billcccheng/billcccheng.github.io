<html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<head>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.15.1/vis.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">

<title>Study Abroad Crawler</title>

</head>
    <body>
    <h3>Welcome to PTT Studyabroad Search (Last Update: 04/12/2016)</h3>
    <!-- Start: Copyright 2016 TraceMyIP.org Service Code (163008-04132016)- DO NOT MODIFY //-->
    <div style="line-height:16px;"><script type="text/javascript" src="http://s3.tracemyip.org/tracker/lgUrl.php?stlVar2=1300&amp;rgtype=4684NR-IPIB&amp;pidnVar2=34505&amp;prtVar2=8&amp;scvVar2=12"></script><noscript><a href="http://www.tracemyip.org/tools/online-address-book-web-contact-list/"><img src="http://s3.tracemyip.org/tracker/1300/4684NR-IPIB/34505/8/12/ans/" alt="address book freeware" style="border:0px;"></a></noscript>
    </div>
    <!-- End: TraceMyIP.org Service Code //-->
    <h5>搜尋耗時較久 請耐心等候 絕對不是當掉!!!</h5>
        關鍵字: <input id="query"/> 

        <select id="selection">
            <option value="title">標題</option>
            <option value="content">內文</option>
        </select>
        <button id="search">Search</button>
        <br></br>
        <div id="load"></div>
        <i class="fa fa-spinner fa-pulse fa-2x fa-fw margin-bottom" id="loading"></i>
        <!-- <progress id="progBar" value="0" max="100"></progress> -->
        <div id="results"></div>
    <script type="text/javascript"  charset = UTF-8>
  
    var j = 0;

    function load_view(data){
        var query = $("#query").val();
        var content_or_title = $( "#selection option:selected" ).text();
        
        for(i = 0; i < data.length; i++){
            if(data[i][content_or_title].search(query) != -1){
                j++;
                $('#results').append('<br><div>' + '' + j + ': '+ data[i].標題 + "<br><a href="+ data[i].link +'>Link</a></div>');
            }       
        }
        
        // console.log(now-(new Date).getTime());
    }
    
    function get_data(){
        // $("#load").text("Loading...");
        // blink(true);
        // $("#progBar").show();
        // now = (new Date).getTime();
        $("#loading").show();
        $.getJSON("https://raw.githubusercontent.com/billcccheng/ptt-crawler-indexer/master/data/data1.json", function(json) {
            load_view(json);
        });
        $.getJSON("https://raw.githubusercontent.com/billcccheng/ptt-crawler-indexer/master/data/data2.json", function(json) {
            load_view(json);
        });
        $.getJSON("https://raw.githubusercontent.com/billcccheng/ptt-crawler-indexer/master/data/data3.json", function(json) {
            load_view(json);
        });
        $.getJSON("https://raw.githubusercontent.com/billcccheng/ptt-crawler-indexer/master/data/data4.json", function(json) {
            load_view(json);
        });
        $.getJSON("https://raw.githubusercontent.com/billcccheng/ptt-crawler-indexer/master/data/data5.json", function(json) {
            load_view(json);
        });
        $.getJSON("https://raw.githubusercontent.com/billcccheng/ptt-crawler-indexer/master/data/data6.json", function(json) {
            load_view(json);
            $("#loading").hide();
        });
    }

    function on_ready(){
         $("#loading").hide();
        $('#search').click(function(){
            j = 0
            $( "#results" ).empty();
            get_data();
          });

        $('body').keypress(function(e) {
            j = 0
            if (e.keyCode == '13') {
                $( "#results" ).empty();
                get_data();
            }
        });
    }

    // function blink(turn_blink_on){
    //     var t = setInterval(function () {
    //         var ele = document.getElementById('load');
    //         ele.style.visibility = (ele.style.visibility == 'hidden' ? '' : 'hidden');
    //     }, 500);
    // }

    $(document).ready(on_ready);


     // $.ajax({
        //   xhr: function()
        //   {
        //     var xhr = new window.XMLHttpRequest();
        //     //Upload progress
        //     xhr.upload.addEventListener("progress", function(evt){
        //       if (evt.lengthComputable) {
        //         var percentComplete = evt.loaded / evt.total;
        //         //Do something with upload progress
        //         console.log(percentComplete);
        //       }
        //     }, false);
        //     //Download progress
        //     xhr.addEventListener("progress", function(evt){
        //       if (evt.lengthComputable) {
        //         var percentComplete = evt.loaded / evt.total;
        //         //Do something with download progress
        //         console.log(percentComplete);
        //         $("#progBar").val(percentComplete*100);
        //       }
        //     }, false);
        //     return xhr;
        //   },
        //   type: 'GET',
        //    // testing url = https://api.myjson.com/bins/yhp0
        //   url: "https://raw.githubusercontent.com/billcccheng/ptt-crawler-indexer/master/data/data1.json",
        //   data: {},
        //   success: function(data){
        //     load_view(data)
        //   }
        // });
    

    </script>
    </body>
</html>
