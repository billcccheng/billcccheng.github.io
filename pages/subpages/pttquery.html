<html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<head>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.15.1/vis.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.15.1/vis.min.css" rel="stylesheet" type="text/css" />
<title>Study Abroad Crawler</title>

</head>
    <body>
    <h3>Welcome to PTT Studyabroad Search</h3>
        關鍵字: <input id="query"/> 

        <select id="selection">
            <option value="title">標題</option>
            <option value="content">內文</option>
        </select>
        <button id="search">Search</button>
        <br></br>
        <div id="load"></div>
        <div id="results"></div>

    <script type="text/javascript"  charset = UTF-8>
  

    function load_view(data){
        var query = $("#query").val();
        var content_or_title = $( "#selection option:selected" ).text();
        for(i = 0; i < data.length; i++){
            if(data[i][content_or_title].search(query) != -1){
                var j = i + 1;
                $('#results').append('<br><div>' + '' + j + ': '+ data[i].標題 + "<br><a href="+ data[i].link +'>Link</a></div>');
            }       
        }
        $("#load").text("Finished");
        blink(false);

    }
    // testing url = https://api.myjson.com/bins/yhp0
    function get_data(){
        $("#load").text("Loading...");
        blink(true);
        $.getJSON("data.json", function(json) {
            load_view(json);
        });
    }

    function on_ready(){
        $('#search').click(function(){
            $( "#results" ).empty();
            get_data();
          });

        $('body').keypress(function(e) {
          if (e.keyCode == '13') {
            $( "#results" ).empty();
            get_data();
          }
      });
    }

    var blink_elements = [];
    function blink(turn_blink_on){
        if(turn_blink_on){
            var t = setInterval(function () {
                var ele = document.getElementById('load');
                ele.style.visibility = (ele.style.visibility == 'hidden' ? '' : 'hidden');
            }, 500);
            blink_elements.push(t);
        }else{
            t = blink_elements.pop();
            clearInterval(t);
        }
    }

    $(document).ready(on_ready);


    </script>
    </body>
</html>