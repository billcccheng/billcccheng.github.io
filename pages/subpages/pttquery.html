<html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<head>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.15.1/vis.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">

<title>Study Abroad Crawler</title>

</head>
    <body background="http://www.designbolts.com/wp-content/uploads/2013/02/Free-Seamless-Wood-Textures-Patterns-For-3D-Mapping-2.jpg">
    <h1>Welcome to PTT Studyabroad Search</h1> <h3>By Bill Cheng(billcccheng@gmail.com) Last Update: 04/12/2016</h3>
    <!-- Start: Copyright 2016 TraceMyIP.org Service Code (163008-04132016)- DO NOT MODIFY //-->
    <div style="line-height:16px;"><script type="text/javascript" src="http://s3.tracemyip.org/tracker/lgUrl.php?stlVar2=1300&amp;rgtype=4684NR-IPIB&amp;pidnVar2=34505&amp;prtVar2=8&amp;scvVar2=12"></script><noscript><a href="http://www.tracemyip.org/tools/online-address-book-web-contact-list/"><img src="http://s3.tracemyip.org/tracker/1300/4684NR-IPIB/34505/8/12/ans/" alt="address book freeware" style="border:0px;"></a></noscript>
    </div>
    <!-- End: TraceMyIP.org Service Code //-->
    <h5>搜尋可能耗時較久 請耐心等候</h5>
        關鍵字: <input id="query"/> 

        <select id="selection">
            <option value="title">標題</option>
            <option value="content">內文</option>
        </select>
        <button id="search">Search</button>
        <br></br>
        <div id="load"></div>
        <i class="fa fa-spinner fa-pulse fa-2x fa-fw margin-bottom" id="loading"></i>
        <div id="results"></div>
    <script type="text/javascript">
  
    var j = 0;

    function load_view(data){
        var query = $("#query").val();
        var content_or_title = $( "#selection option:selected" ).text();
        query = new RegExp(query, "i")
        for(i = 0; i < data.length; i++){
            if(data[i][content_or_title].match(query)){
                j++;
                $('#results').append('<br><div>' + '' + j + ': '+ data[i].標題 + "<br><a href="+ data[i].link +'>Link</a></div>');
            }       
        }
    }
    
    function get_data(){
        $("#loading").show();
        for(i = 0; i < 6; i++){
            var j = i + 1;
            var url = "https://raw.githubusercontent.com/billcccheng/ptt-crawler-indexer/master/data/data"+ j +".json"
            if(j != 6){
                $.getJSON(url, function(json) {
                    load_view(json);
                });
            }else {
                $.getJSON(url, function(json) {
                    $("#loading").hide();
                    load_view(json);
                });
            }
        }
    }

    function on_ready(){
         $("#loading").hide();
        $('#search').click(function(){
            j = 0
            $( "#results" ).empty();
            get_data();
          });

        $('body').keypress(function(e) {
            j = 0
            if (e.keyCode == '13') {
                $( "#results" ).empty();
                get_data();
            }
        });
    }
    $(document).ready(on_ready);
    </script>
    </body>
</html>
