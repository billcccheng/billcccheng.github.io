<html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<head>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.15.1/vis.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">

<title>Study Abroad Crawler</title>

</head>
    <body background="http://www.designbolts.com/wp-content/uploads/2013/02/Free-Seamless-Wood-Textures-Patterns-For-3D-Mapping-2.jpg">
    <h1>Welcome to PTT Studyabroad Search</h1> <h3>By Bill Cheng(billcccheng@gmail.com)</h3>
        <p>Keywords:</p>
        <p>
            <div id="search-query">
                <input style="width: 200px " id="query_1"/> 
            </div>
            <p><button id="add-search"> Add Keywords </button></p>
        </p>
        <p>
            <!-- <select id="selection">
                <option value="title">標題</option>
                <option value="content">內文</option>
            </select> -->
            <button id="search" >Search</button>
        </p>
        
        <p>
            <div id="load"></div>
            <i class="fa fa-spinner fa-pulse fa-2x fa-fw margin-bottom" id="loading"></i>
            <div id="results"></div>
        </p>
    <script type="text/javascript">
    var query = 1
    $("#add-search").click(function(){
        query++;
        $('#search-query').append('<p><input style="width: 200px " id="query_'+ query +'"/></p>');
    });



    var id = 0;
    function load_view(data){
        var query = $("#query").val();
        for(i = 0; i < $('#search-query').children().length; i++){
            // var index = i+1;
            var query_id = "#query_"+(i+1).toString();
        }
        
        // var content_or_title = $( "#selection option:selected" ).text();
        query = new RegExp(query, "i")
        for(i = 0; i < data.length; i++){
            var isTrue = true;
            for(j = 0; j < $('#search-query').children().length; j++){
                var query_id = "#query_"+(j+1).toString();
                query = $(query_id).val();
                query = new RegExp(query, "i");
                isTrue = isTrue && (data[i]["內文"].match(query) != null);
            }
            // console.log(isTrue);

            if(isTrue){
                id++;
                $('#results').append('<p>' + '' + id + ': '+ data[i].標題 + " <a href="+ data[i].link +'>Link</a></p>');
            }       
        }
        // console.log(isTrue);
    }
    
    function get_data(){
        $("#loading").show();
        for(i = 0; i < 10; i++){
            var url = "https://raw.githubusercontent.com/billcccheng/ptt-crawler-indexer/threading/data/data-"+ i +".json"
            if(i != 9){
                $.getJSON(url, function(json) {
                    load_view(json);
                });
            }else {
                $.getJSON(url, function(json) {
                    $("#loading").hide();
                    load_view(json);
                });
            }
        }
    }
    function on_ready(){
         $("#loading").hide();
        $('#search').click(function(){
            id = 0
            $( "#results" ).empty();
            get_data();
          });
        $('body').keypress(function(e) {
            id = 0
            if (e.keyCode == '13') {
                $( "#results" ).empty();
                get_data();
            }
        });
    }
    $(document).ready(on_ready);
    </script>
    </body>
</html>
